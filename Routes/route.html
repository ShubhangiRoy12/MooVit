<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="favicon.png">
  <title>üß≠ Routes ‚Äì MooVit</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../styles.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }
    .stat-card {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: .5rem;
      text-align: center;
    }
    .actions {
      visibility: hidden;
    }
    .table-hover tbody tr:hover .actions {
      visibility: visible;
    }
  </style>
</head>
<body>
  <nav class="main-nav">
    <a href="/main.html" class="logo">MooVit</a>
    <ul class="nav-links">
        <li><a href="/main.html">Dashboard</a></li>
        <li><a href="/Shipments/shipments.html">Shipments</a></li>
        <li><a href="/Vehicles/vechicle.html">Vehicles</a></li>
        <li><a href="/Routes/route.html">Routes</a></li>
        <li><a href="/Profile/profile.html">Profile</a></li>
        <li><a href="/Schedule/schedule.html">Schedule</a></li>
        <li><a href="/login.html">Logout</a></li>
    </ul>
    <div class="burger">
        <div class="line1"></div>
        <div class="line2"></div>
        <div class="line3"></div>
    </div>
</nav>

  <main class="container my-4">
    <div class="row g-3 mb-4">
      <div class="col-md-3 stat-card">
        <h5>Active Routes</h5>
        <h3 id="statActive">0</h3>
      </div>
      <div class="col-md-3 stat-card">
        <h5>Avg Distance</h5>
        <h3 id="statAvg">0</h3>
      </div>
      <div class="col-md-3 stat-card">
        <h5>Completed Today</h5>
        <h3 id="statComp">0</h3>
      </div>
      <div class="col-md-3 stat-card">
        <h5>Delayed</h5>
        <h3 id="statDelayed">0</h3>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card p-3"><canvas id="trendChart" height="200"></canvas></div>
      </div>
      <div class="col-md-6">
        <div class="card p-3"><canvas id="statusChart" height="200"></canvas></div>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <table class="table table-striped table-hover align-middle" id="routesTable">
          <thead>
            <tr>
              <th>Route ID</th>
              <th>Origin</th>
              <th>Destination</th>
              <th>Status</th>
              <th>Distance</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="emptyState" class="text-center text-muted py-5">No routes added. Click ‚Äú+ Add‚Äù</div>
        <button id="addBtn" class="btn btn-primary">+ Add Route</button>
      </div>
    </div>
  </main>
  
  <footer class="text-center py-2 bg-light">&copy; 2025 MooVit. All rights reserved.</footer>

  <div class="modal fade" id="modal" tabindex="-1">
    <div class="modal-dialog">
      <form class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Route</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input id="routeId" class="form-control mb-2" placeholder="Route ID" required>
          <input id="origin" class="form-control mb-2" placeholder="Origin" required>
          <input id="destination" class="form-control mb-2" placeholder="Destination" required>
          <select id="status" class="form-select mb-2" required>
            <option value="" disabled selected>Status</option>
            <option>On schedule</option>
            <option>Delayed</option>
            <option>Completed</option>
          </select>
          <label>Distance (km):</label>
          <div class="input-group mb-2">
            <button type="button" id="decDist" class="btn btn-outline-secondary">‚àí</button>
            <input id="distance" type="number" class="form-control text-center" value="1" min="1" readonly>
            <button type="button" id="incDist" class="btn btn-outline-secondary">Ôºã</button>
          </div>
        </div>
        <div class="modal-footer"><button type="submit" class="btn btn-success">Save</button></div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const modal = new bootstrap.Modal(document.getElementById('modal'));
    const tbody = document.querySelector('#routesTable tbody');
    const empty = document.getElementById('emptyState');
    let stats = { active: 0, delayed: 0, completed: 0, totalDist: 0 };

    addBtn.onclick = () => {
      document.querySelector('.modal-title').textContent = 'Add Route';
      document.querySelector('form').reset();
      distance.value = 1;
      modal.show();
    };
    incDist.onclick = () => distance.stepUp();
    decDist.onclick = () => distance.stepDown();

    document.querySelector('#modal form').onsubmit = e => {
      e.preventDefault();
      const s = status.value;
      const color = s === 'On schedule' ? 'info' : s === 'Delayed' ? 'warning' : 'success';
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${routeId.value.trim()}</td>
        <td>${origin.value.trim()}</td>
        <td>${destination.value.trim()}</td>
        <td><span class="badge bg-${color} statusBadge">${s}</span></td>
        <td>${distance.value}</td>
        <td class="actions">
          <button class="btn btn-sm btn-success compBtn">Complete</button>
          <button class="btn btn-sm btn-danger delBtn">Delete</button>
        </td>`;
      tbody.append(row);

      compBtn = row.querySelector('.compBtn');
      compBtn.onclick = () => {
        const badge = row.querySelector('.statusBadge');
        badge.textContent = 'Completed';
        badge.className = 'badge bg-success statusBadge';
        update();
      };
      row.querySelector('.delBtn').onclick = () => { row.remove(); update(); };
      modal.hide();
      update();
    };

    function update() {
      const rows = Array.from(tbody.rows);
      stats = { active: 0, delayed: 0, completed: 0, totalDist: 0 };
      rows.forEach(r => {
        const st = r.querySelector('.statusBadge').textContent.trim();
        const dist = +r.cells[4].textContent;
        stats.totalDist += dist;
        if (st === 'Delayed') stats.delayed++;
        if (st === 'Completed') stats.completed++;
        else stats.active++;
      });
      statActive.textContent = stats.active;
      statDelayed.textContent = stats.delayed;
      statComp.textContent = stats.completed;
      statAvg.textContent = rows.length ? Math.round(stats.totalDist / rows.length) : 0;
      empty.style.display = rows.length ? 'none' : '';
      redrawTrend(rows);
      redrawStatus();
    }

    const trendChart = new Chart(document.getElementById('trendChart'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'Distance (km)', data: [], backgroundColor: '#0d6efd' }] },
      options: { scales: { y: { beginAtZero: true } } }
    });
    const statusChart = new Chart(document.getElementById('statusChart'), {
      type: 'doughnut',
      data: { labels: ['On schedule', 'Delayed', 'Completed'], datasets: [{ data: [0, 0, 0], backgroundColor: ['#0d6efd', '#ffc107', '#198754'] }] },
      options: { plugins: { legend: { position: 'bottom' } } }
    });

    function redrawTrend(rows) {
      const days = [...Array(7)].map((_, i) => {
        const d = new Date(); d.setDate(d.getDate() - i);
        return d.toISOString().slice(5, 10);
      }).reverse();
      const data = days.map(_ => 0);
      rows.forEach(r => {
        const eta = new Date();
        const idx = days.length - 1; // no date info, so just last
        data[idx] += +r.cells[4].textContent;
      });
      trendChart.data.labels = days;
      trendChart.data.datasets[0].data = data;
      trendChart.update();
    }
    function redrawStatus() {
      statusChart.data.datasets[0].data = [stats.active, stats.delayed, stats.completed];
      statusChart.update();
    }
  </script>
  <script>
    const navSlide = () => {
      const burger = document.querySelector('.burger');
      const nav = document.querySelector('.nav-links');
      burger.addEventListener('click', () => {
        nav.classList.toggle('nav-active');
        burger.classList.toggle('toggle');
      });
    }
    navSlide();
  </script>
</body>
</html>